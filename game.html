<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Windows 11 Dark Theme Palette */
      --bg-gradient: #495bff;
      --glass-bg: rgba(94, 110, 255, 0.1); /* Fixed alpha */
      --glass-border: rgba(255, 255, 255, 0.08);
      --accent-color: #6c7bff; 
      --text-main: #ffffff;
      --text-muted: #a1a1a1;
      --taskbar-bg: rgba(28, 28, 28, 0.85);
      --favorite-color: #ffd700;
      --coin-color: #ffffff;
    }

    .stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
      animation: twinkle 4s ease-in-out infinite;
    }

    @keyframes twinkle {
      0% { opacity: 0.2; }
      25% { opacity: 0.5; }
      50% { opacity: 1; }
      75% { opacity: 0.5; }
      100% { opacity: 0.2; }
    }

    @keyframes starGlow {
      0%, 100% { 
        text-shadow: 
          0 0 8px rgba(255, 215, 0, 1),
          0 0 16px rgba(255, 215, 0, 0.8),
          0 0 24px rgba(255, 215, 0, 0.6),
          0 0 32px rgba(255, 215, 0, 0.4);
      }
      50% { 
        text-shadow: 
          0 0 12px rgba(255, 215, 0, 1),
          0 0 20px rgba(255, 215, 0, 0.9),
          0 0 32px rgba(255, 215, 0, 0.7),
          0 0 40px rgba(255, 215, 0, 0.5);
      }
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: "Segoe UI Variable", "Segoe UI", "Poppins", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
    }

    /* --- Iframe (Game Screen) --- */
    iframe {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      display: none; 
      z-index: 1;
      background: black;
    }

    /* --- Overlay (Start Screen) --- */
    .viewer-overlay {
      position: fixed;
      inset: 0;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(25px) saturate(1.5);
      transition: opacity 0.5s ease;
    }

    .game-info-large {
      margin-bottom: 40px;
      text-align: center;
    }

    .game-title-large {
      font-size: 4rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 10px;
      letter-spacing: -1.5px;
    }

    .game-author {
      color: var(--text-muted);
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* Win11 Blue Play Button */
    #playBtn {
      padding: 15px 45px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--accent-color);
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 15px rgba(0, 120, 212, 0.3);
    }

    #playBtn svg { width: 20px; height: 20px; fill: white; }
    #playBtn:hover { transform: scale(1.02); filter: brightness(1.1); }
    #playBtn:active { transform: scale(0.98); }

    /* --- Bottom HUD (Controls) --- */
    .game-bar {
      position: fixed;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      height: 60px;
      background: var(--taskbar-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      gap: 20px;
      z-index: 10;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      transition: opacity 0.3s ease;
    }

    .game-left, .game-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .game-title-small {
      font-weight: 500;
      font-size: 0.9rem;
      color: #fff;
      margin-right: 10px;
    }

    /* Taskbar Icon Style Buttons */
    .control-btn {
      width: 40px;
      height: 40px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--text-main);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }

    .control-btn svg { width: 20px; height: 20px; fill: currentColor; }
    .control-btn:hover { background: rgba(255, 255, 255, 0.1); }

    /* Settings Menu */
    .settings-menu {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--taskbar-bg);
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 15px;
      width: 280px;
      display: none;
      flex-direction: column;
      gap: 12px;
      z-index: 999;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
    }

    .settings-menu.show {
      display: flex;
    }

    .settings-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .settings-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .settings-input {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid var(--glass-border);
      background: rgba(40, 40, 40, 0.6);
      color: var(--text-main);
      font-size: 13px;
      font-family: inherit;
      outline: none;
      transition: all 0.2s ease;
    }

    .settings-input:focus {
      background: rgba(50, 50, 50, 0.8);
      border-color: var(--accent-color);
    }

    .cursor-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .cursor-option {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid var(--glass-border);
      background: rgba(40, 40, 40, 0.6);
      color: var(--text-main);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .cursor-option:hover {
      background: rgba(60, 60, 60, 0.8);
      border-color: var(--accent-color);
    }

    .cursor-option.active {
      background: var(--accent-color);
      border-color: var(--accent-color);
    }

    .settings-button {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      background: var(--accent-color);
      color: white;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
    }

    .settings-button:hover {
      opacity: 0.9;
      box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(5px);
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: var(--taskbar-bg);
      backdrop-filter: blur(20px) saturate(1.5);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
    }

    .modal-header {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-main);
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: var(--text-main);
      font-size: 1.5rem;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s ease;
    }

    .modal-close:hover {
      opacity: 1;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 5px;
      color: var(--text-muted);
      font-weight: 600;
    }

    .form-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid var(--glass-border);
      background: rgba(40, 40, 40, 0.6);
      color: var(--text-main);
      font-size: 14px;
      font-family: inherit;
      outline: none;
      transition: all 0.2s ease;
    }

    .form-input:focus {
      background: rgba(50, 50, 50, 0.8);
      border-color: var(--accent-color);
    }

    .form-btn {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: var(--accent-color);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 10px;
    }

    .form-btn:hover {
      opacity: 0.9;
      box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
    }

    .form-toggle {
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .form-toggle button {
      background: none;
      border: none;
      color: var(--accent-color);
      cursor: pointer;
      text-decoration: underline;
    }

    .profile-info {
      background: rgba(0, 120, 212, 0.1);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .profile-stat {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .profile-stat-label {
      color: var(--text-muted);
    }

    .profile-stat-value {
      color: var(--text-main);
      font-weight: 600;
    }

    .shop-grid {
      display: grid;
      gap: 15px;
    }

    .shop-item {
      background: rgba(255, 165, 0, 0.1);
      border: 1px solid rgba(255, 165, 0, 0.3);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s ease;
    }

    .shop-item:hover {
      background: rgba(255, 165, 0, 0.15);
      border-color: rgba(255, 165, 0, 0.5);
    }

    .shop-item-info {
      flex: 1;
    }

    .shop-item-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .shop-item-price {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--coin-color);
      font-size: 0.9rem;
      font-weight: 600;
    }

    .shop-btn {
      padding: 6px 12px;
      background: var(--coin-color);
      border: none;
      border-radius: 4px;
      color: #000;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .shop-btn:hover {
      opacity: 0.9;
      transform: scale(1.05);
    }

    .shop-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .daily-quest {
      background: rgba(0, 120, 212, 0.1);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .quest-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text-main);
    }

    .quest-progress {
      margin-bottom: 10px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 5px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-color), var(--favorite-color));
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .quest-reward {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--glass-border);
      font-size: 0.9rem;
    }

    .coin-icon {
      color: var(--coin-color);
      font-weight: 700;
    }

    /* --- Sidebar Taskbar (Hidden when playing) --- */
    .sidebar {
      width: fit-content;
      height: 60px;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--taskbar-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      display: flex;
      padding: 0 15px;
      gap: 8px;
      z-index: 100;
      transition: transform 0.5s ease;
    }

    .nav-btn {
      width: 45px;
      height: 45px;
      border-radius: 6px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .nav-btn svg { width: 22px; height: 22px; fill: #fff; }

    /* Loading Screen Styles */
    #loadingScreen {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(25px) saturate(1.5);
      z-index: 3;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text-main);
      font-size: 1.2rem;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid var(--text-main);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #quote {
      max-width: 80%;
      text-align: center;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .game-bar { min-width: 90%; padding: 0 10px; }
      .game-title-large { font-size: 2.5rem; }
    }
    /* width */
::-webkit-scrollbar {
  width: 10px;
}

/* Track */
::-webkit-scrollbar-track {
  background: #0688e5;
}

/* Handle */
::-webkit-scrollbar-thumb {
  background: #005494;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: #00457a;
}
  </style>
</head>

<body>
<div class="stars-container" id="starsContainer"></div>

<div class="viewer-overlay" id="overlay">
    <div class="game-info-large">
      <div class="game-title-large" id="bigGameTitle">Loading...</div>
      <div class="game-author">Hosted in Andromeda by Cementful</div>
    </div>
    <button id="playBtn" onclick="playGame()">
      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      Run Program
    </button>

    <nav class="sidebar" style="bottom: 40px; position: absolute;">
      <a href="home.html"><button class="nav-btn"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></button></a>
      <a href="index.html"><button class="nav-btn"><svg viewBox="0 0 24 24"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg></button></a>
      <a href="apps.html"><button class="nav-btn"><svg viewBox="0 0 24 24"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg></button></a>
      <button class="nav-btn" id="settingsBtn"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.62l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.48.1.62l2.03 1.58c-.05.3-.07.62-.07.94 0 .33.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.62l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.48-.1-.62l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </nav>
</div>

<div id="loadingScreen">
  <div class="spinner"></div>
  <p id="quote"></p>
</div>

<iframe id="gameFrame"></iframe>

<!-- Settings Menu -->
<div class="settings-menu" id="settingsMenu">
  <div class="settings-group">
    <label class="settings-label">Site Name</label>
    <input type="text" class="settings-input" id="siteName" placeholder="Enter site name">
  </div>

  <div class="settings-group">
    <label class="settings-label">Cursor Style</label>
    <div class="cursor-selector">
      <button class="cursor-option active" data-cursor="auto">Default</button>
      <button class="cursor-option" data-cursor="crosshair">Crosshair</button>
      <button class="cursor-option" data-cursor="grab">Grab</button>
      <button class="cursor-option" data-cursor="cell">Cell</button>
      <button class="cursor-option" data-cursor="zoom-in">Zoom In</button>
      <button class="cursor-option" data-cursor="zoom-out">Zoom Out</button>
    </div>
  </div>

  <div class="settings-group">
    <label class="settings-label">Favicon</label>
    <input type="file" class="settings-input" id="faviconInput" accept="image/*">
  </div>

  <button class="settings-button" id="resetBtn">Reset to Default</button>
</div>

<div class="game-bar" id="gameHUD" style="display: none;">
  <div class="game-left">
    <button class="control-btn" onclick="window.location.href='index.html'" title="Exit">
      <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
    </button>
    <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.15);"></div>
    <button class="control-btn" onclick="openModal('profileModal')" title="Profile">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
    </button>
    <button class="control-btn" onclick="openModal('shopModal')" title="Shop">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    </button>
    <button class="control-btn" onclick="openModal('questModal')" title="Daily Quest">
      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
    </button>
    <span class="game-title-small" id="gameTitle">Game Name</span>
  </div>

  <div class="game-right">
    <button class="control-btn" onclick="reloadGame()" title="Reload">
      <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
    </button>
    <button class="control-btn" onclick="fullscreen()" title="Toggle Fullscreen">
      <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
    </button>
  </div>
</div>

<!-- Profile Modal -->
<div class="modal" id="profileModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('profileModal')">Ã—</button>
    <div class="modal-header">Account</div>
    
    <div id="loginForm">
      <div class="form-group">
        <label class="form-label">Username</label>
        <input type="text" class="form-input" id="loginUsername" placeholder="Enter username">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="loginPassword" placeholder="Enter password">
      </div>
      <button class="form-btn" onclick="handleLogin()">Login</button>
      <div class="form-toggle">
        Don't have an account? <button onclick="toggleAuthForm()">Sign Up</button>
      </div>
    </div>

    <div id="signupForm" style="display: none;">
      <div class="form-group">
        <label class="form-label">Username</label>
        <input type="text" class="form-input" id="signupUsername" placeholder="Create username">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="signupPassword" placeholder="Create password">
      </div>
      <button class="form-btn" onclick="handleSignup()">Sign Up</button>
      <div class="form-toggle">
        Already have an account? <button onclick="toggleAuthForm()">Login</button>
      </div>
    </div>

    <div id="profileView" style="display: none;">
      <div class="profile-info">
        <div class="profile-stat">
          <span class="profile-stat-label">Username:</span>
          <span class="profile-stat-value" id="profileUsername">-</span>
        </div>
        <div class="profile-stat">
          <span class="profile-stat-label">Coins:</span>
          <span class="profile-stat-value"><span style="color: var(--coin-color);">ðŸ’°</span> <span id="profileCoins">0</span></span>
        </div>
        <div class="profile-stat">
          <span class="profile-stat-label">Playtime:</span>
          <span class="profile-stat-value" id="profilePlaytime">0 min</span>
        </div>
        <div class="profile-stat">
          <span class="profile-stat-label">Quests Completed:</span>
          <span class="profile-stat-value" id="profileQuests">0</span>
        </div>
      </div>
      <button class="form-btn" onclick="handleLogout()" style="background: #dc3545;">Logout</button>
    </div>
  </div>
</div>

<!-- Shop Modal -->
<div class="modal" id="shopModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('shopModal')">Ã—</button>
    <div class="modal-header">Shop</div>
    <div class="form-label" style="margin-bottom: 15px;">ðŸ’° Balance: <span id="shopBalance">0</span></div>
    <div class="shop-grid" id="shopItems"></div>
  </div>
</div>

<!-- Quest Modal -->
<div class="modal" id="questModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('questModal')">Ã—</button>
    <div class="modal-header">Daily Quest</div>
    <div class="daily-quest">
      <div class="quest-title">Play Games - 60 Minutes</div>
      <div class="quest-progress">
        <div class="progress-bar">
          <div class="progress-fill" id="questProgress" style="width: 0%"></div>
        </div>
        <div class="progress-text"><span id="questTime">0</span> / 60 minutes</div>
      </div>
      <div class="quest-reward">
        <span>Complete for reward:</span>
        <span class="coin-icon">ðŸ’° 20</span>
      </div>
      <button class="form-btn" id="questBtn" onclick="completeQuest()" style="margin-top: 15px; display: none;">Claim Reward</button>
    </div>
  </div>
</div>

<script>

      // Generate decorative stars
    function generateStars() {
      const starsContainer = document.getElementById('starsContainer');
      const starCount = window.innerWidth > 768 ? 100 : 50;
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        starsContainer.appendChild(star);
      }
    }

    // Generate stars on page load
    generateStars();
  // Settings functionality
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsMenu = document.getElementById('settingsMenu');
  const siteName = document.getElementById('siteName');
  const faviconInput = document.getElementById('faviconInput');
  const resetBtn = document.getElementById('resetBtn');
  const cursorOptions = document.querySelectorAll('.cursor-option');

  // Toggle settings menu
  settingsBtn.addEventListener('click', () => {
    settingsMenu.classList.toggle('show');
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#settingsBtn') && !e.target.closest('#settingsMenu')) {
      settingsMenu.classList.remove('show');
    }
  });

  // Load settings from localStorage
  function loadSettings() {
    const savedName = localStorage.getItem('siteName') || 'Andromeda';
    const savedCursor = localStorage.getItem('cursorStyle') || 'auto';
    const savedFavicon = localStorage.getItem('faviconData');

    siteName.value = savedName;
    document.title = savedName + '';
    document.body.style.cursor = savedCursor;

    // Update cursor button states
    cursorOptions.forEach(btn => {
      btn.classList.remove('active');
      if (btn.getAttribute('data-cursor') === savedCursor) {
        btn.classList.add('active');
      }
    });

    // Load favicon
    if (savedFavicon) {
      setFavicon(savedFavicon);
    }
  }

  // Site name change
  siteName.addEventListener('change', (e) => {
    const newName = e.target.value || 'Andromeda';
    localStorage.setItem('siteName', newName);
    document.title = newName + '';
  });

  // Cursor style change
  cursorOptions.forEach(btn => {
    btn.addEventListener('click', () => {
      const cursor = btn.getAttribute('data-cursor');
      localStorage.setItem('cursorStyle', cursor);
      document.body.style.cursor = cursor;

      cursorOptions.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // Favicon upload
  faviconInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        const dataUrl = event.target.result;
        localStorage.setItem('faviconData', dataUrl);
        setFavicon(dataUrl);
      };
      reader.readAsDataURL(file);
    }
  });

  // Set favicon
  function setFavicon(dataUrl) {
    let link = document.querySelector("link[rel~='icon']");
    if (!link) {
      link = document.createElement('link');
      link.rel = 'icon';
      document.head.appendChild(link);
    }
    link.href = dataUrl;
  }

  // Reset to default
  resetBtn.addEventListener('click', () => {
    localStorage.clear();
    siteName.value = 'Andromeda';
    document.title = '';
    document.body.style.cursor = 'auto';
    
    let link = document.querySelector("link[rel~='icon']");
    if (link) link.href = '';

    cursorOptions.forEach(btn => btn.classList.remove('active'));
    cursorOptions[0].classList.add('active');

    faviconInput.value = '';
    settingsMenu.classList.remove('show');
  });

  // Initialize settings on page load
  loadSettings();

const FILE_URL = sessionStorage.getItem("gameUrl"); 
const GAME_NAME = sessionStorage.getItem("gameName") || "Unknown Program"; 
const frame = document.getElementById("gameFrame");
const hud = document.getElementById("gameHUD");

document.getElementById("gameTitle").textContent = GAME_NAME;
document.getElementById("bigGameTitle").textContent = GAME_NAME;

async function playGame() {
  const overlay = document.getElementById("overlay");
  overlay.style.opacity = '0';
  
  setTimeout(() => {
    overlay.style.display = 'none';
  }, 500);

  // Show loading screen
  const loading = document.getElementById('loadingScreen');
  loading.style.display = 'flex';

  // Random quote generator
  const quotes = [
    "CITY BOYYY CITY BOYY",
    "If u read this, ur gay",
    "I luv cementful <3 - Cementful",
    "Skibidi sigma",
    "67",
    "Bradley likes coolkidd",
    "Have you heard of the new reastaurant? Its called Karma. Thereâ€™s no menu - you get what you deserve.",
    "Thats why hes the goat",
    "every staff is underpaid",
    "Waking up at 3 am to code is peak productivity.",
    "I beat it to harken Die of Death",
    "MY MOM IS KINDA HOMELESSðŸ˜­",
    "Ts is tuff lil boy",
    "California grills are unforgetabble",
    "ðŸ¤£ðŸ¤£ðŸ¤£ðŸ¤£ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸ˜ƒðŸ˜ƒðŸ˜ƒ",
    "Im an IPad kid",
    "D-daddy~",
    "This is an undertale refrence",
    "Never gonna give you up",
    "Never gonna let you down",
    "Never gonna turn around",
    "And desert you",
    "You said too late to start got your heart in a headlock",
    "I don't belive any of this",
    "Distant Flickering, Greener Sceenery",
    "The weather's bringing it all back again",
    "With great intention,",
    "Still hosted at your station",
    "Touch grass",
    "You're not slick my guy",
    "I luv touching detal mick",
    "They say my hunger's a problem",
    "They told me to curb my appetite",
    "They say I can't keep myself from trying a bite of every plate in sight.",
    "They worship patience, a virtue",
    "They told me gluttony's a sin",
    "But my desire, It's bottomless",
    "And I can't continue the lyrics of butcher vanity",
    "The condition of GTA 6 rn:",
    "I like fire trucks",
    "Stop hating on forsaken",
    "Amongus",
    "AHHH FRESH MEAT",
    "ahhh rotten vegetable",
    "Yo who searched up toy chica ðŸŒ½",
    "Dandys world player is a ðŸŒ½ball",
    "Im a multifandomist spawnist",
    "brother noah",
    "bobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobob",
    "Silly gubby want silly carrots",
    "DRIVING IN MY CAR-",
    "WHAT IS THIS DIDDY BLUD DOING ON THE CALCULATOR IS BLUD EINSTEIN",
    "Never play this on school property",
    "Credits to gn math and truffled.lol",
    "Paygorn",
    "skibiid",
    "skadi bop yes yes yes",
    "nksnfjjshdh",
    "AHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH",
    "Gooning",
    "Hot singles near ur area",
    ];
  const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
  document.getElementById('quote').textContent = randomQuote;

  // Minimum load time of 5 seconds
  const minLoadTime = new Promise(resolve => setTimeout(resolve, 5000));

  let htmlContent;
  try {
    const response = await fetch(FILE_URL);
    htmlContent = await response.text();
    const baseUrl = FILE_URL.substring(0, FILE_URL.lastIndexOf('/') + 1);
    
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlContent, 'text/html');
    
    if (!doc.querySelector('base')) {
      const base = doc.createElement('base');
      base.href = baseUrl;
      doc.head ? doc.head.insertBefore(base, doc.head.firstChild) : doc.documentElement.insertBefore(base, doc.documentElement.firstChild);
    }
    htmlContent = doc.documentElement.outerHTML;
  } catch (e) {
    htmlContent = null;
  }

  // Wait for both content and minimum time
  await minLoadTime;

  if (htmlContent) {
    frame.srcdoc = htmlContent;
  } else {
    frame.src = FILE_URL; 
  }

  frame.style.display = "block";
  loading.style.display = 'none';
  hud.style.display = 'flex';
}

// --- Fullscreen Logic with Auto-Hide ---
function fullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

// Listen for the fullscreen change event (works for button clicks and ESC key)
document.addEventListener('fullscreenchange', () => {
  if (document.fullscreenElement) {
    // We are in fullscreen: Hide the bar
    hud.style.display = 'none';
  } else {
    // We exited fullscreen: Show the bar again
    // Only show it if the game has actually started (overlay is gone)
    if (document.getElementById("overlay").style.display === 'none') {
      hud.style.display = 'flex';
    }
  }
});

function reloadGame() {
  // Efficient way to reload srcdoc
  const currentContent = frame.srcdoc;
  frame.srcdoc = '';
  frame.srcdoc = currentContent;
}

// ===== ACCOUNT & PROFILE SYSTEM =====
let currentUser = null;
let userAccounts = JSON.parse(localStorage.getItem('userAccounts')) || {};

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
  const session = localStorage.getItem('currentSession');
  if (session) {
    currentUser = session;
    updateProfileUI();
  }
});

function toggleAuthForm() {
  const loginForm = document.getElementById('loginForm');
  const signupForm = document.getElementById('signupForm');
  loginForm.style.display = loginForm.style.display === 'none' ? 'block' : 'none';
  signupForm.style.display = signupForm.style.display === 'none' ? 'block' : 'none';
}

function handleLogin() {
  const username = document.getElementById('loginUsername').value.trim();
  const password = document.getElementById('loginPassword').value;
  
  if (!username || !password) {
    alert('Please fill in all fields');
    return;
  }
  
  if (!userAccounts[username] || userAccounts[username].password !== password) {
    alert('Invalid username or password');
    return;
  }
  
  currentUser = username;
  localStorage.setItem('currentSession', username);
  localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
  updateProfileUI();
  startPlaytimeTracking();
  
  document.getElementById('loginUsername').value = '';
  document.getElementById('loginPassword').value = '';
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('signupForm').style.display = 'none';
}

function handleSignup() {
  const username = document.getElementById('signupUsername').value.trim();
  const password = document.getElementById('signupPassword').value;
  
  if (!username || !password) {
    alert('Please fill in all fields');
    return;
  }
  
  if (userAccounts[username]) {
    alert('Username already exists');
    return;
  }
  
  userAccounts[username] = {
    password: password,
    coins: 0,
    playtime: 0,
    questsCompleted: 0,
    ownedCursors: [],
    lastQuestDate: new Date().toDateString()
  };
  
  currentUser = username;
  localStorage.setItem('currentSession', username);
  localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
  updateProfileUI();
  startPlaytimeTracking();
  
  document.getElementById('signupUsername').value = '';
  document.getElementById('signupPassword').value = '';
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('signupForm').style.display = 'none';
}

function handleLogout() {
  currentUser = null;
  localStorage.removeItem('currentSession');
  updateProfileUI();
  playSessionStartTime = null;
}

function updateProfileUI() {
  const loginForm = document.getElementById('loginForm');
  const signupForm = document.getElementById('signupForm');
  const profileView = document.getElementById('profileView');
  const shopBalance = document.getElementById('shopBalance');
  
  if (currentUser && userAccounts[currentUser]) {
    const userData = userAccounts[currentUser];
    loginForm.style.display = 'none';
    signupForm.style.display = 'none';
    profileView.style.display = 'block';
    
    document.getElementById('profileUsername').textContent = currentUser;
    document.getElementById('profileCoins').textContent = userData.coins;
    document.getElementById('profilePlaytime').textContent = userData.playtime + ' min';
    document.getElementById('profileQuests').textContent = userData.questsCompleted;
    
    shopBalance.textContent = userData.coins;
    updateShopUI();
    updateQuestUI();
  } else {
    loginForm.style.display = 'block';
    signupForm.style.display = 'none';
    profileView.style.display = 'none';
  }
}

// ===== SHOP SYSTEM =====
const cursors = [
  { id: 'neon', name: 'âœ¨ Neon Cursor', price: 50 },
  { id: 'fire', name: 'ðŸ”¥ Fire Cursor', price: 75 },
  { id: 'ice', name: 'â„ï¸ Ice Cursor', price: 100 },
  { id: 'rainbow', name: 'ðŸŒˆ Rainbow Cursor', price: 150 }
];

function updateShopUI() {
  if (!currentUser) return;
  
  const shopItems = document.getElementById('shopItems');
  shopItems.innerHTML = '';
  const userData = userAccounts[currentUser];
  
  cursors.forEach(cursor => {
    const isOwned = userData.ownedCursors.includes(cursor.id);
    const item = document.createElement('div');
    item.className = 'shop-item';
    item.innerHTML = `
      <div class="shop-item-info">
        <div class="shop-item-name">${cursor.name}</div>
        <div class="shop-item-price">ðŸ’° ${cursor.price}</div>
      </div>
      <button class="shop-btn" onclick="buyCursor('${cursor.id}', ${cursor.price})" ${isOwned ? 'disabled' : ''}>${isOwned ? 'Owned' : 'Buy'}</button>
    `;
    shopItems.appendChild(item);
  });
}

function buyCursor(cursorId, price) {
  if (!currentUser) return;
  const userData = userAccounts[currentUser];
  
  if (userData.ownedCursors.includes(cursorId)) {
    alert('Already owned');
    return;
  }
  
  if (userData.coins < price) {
    alert('Not enough coins');
    return;
  }
  
  userData.coins -= price;
  userData.ownedCursors.push(cursorId);
  localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
  updateProfileUI();
  alert('Cursor purchased!');
}

// ===== DAILY QUEST SYSTEM =====
function updateQuestUI() {
  if (!currentUser) return;
  
  const userData = userAccounts[currentUser];
  const today = new Date().toDateString();
  
  if (userData.lastQuestDate !== today) {
    userData.playtime = 0;
    userData.lastQuestDate = today;
    localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
  }
  
  const playtime = userData.playtime || 0;
  const progress = Math.min((playtime / 60) * 100, 100);
  const questBtn = document.getElementById('questBtn');
  
  document.getElementById('questProgress').style.width = progress + '%';
  document.getElementById('questTime').textContent = playtime;
  
  if (playtime >= 60) {
    questBtn.style.display = 'block';
  } else {
    questBtn.style.display = 'none';
  }
}

function completeQuest() {
  if (!currentUser) return;
  const userData = userAccounts[currentUser];
  
  if (userData.playtime < 60) {
    alert('Not enough playtime');
    return;
  }
  
  userData.coins += 20;
  userData.questsCompleted += 1;
  userData.playtime = 0;
  userData.lastQuestDate = new Date().toDateString();
  
  localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
  updateProfileUI();
  alert('Quest completed! +20 coins');
  document.getElementById('questBtn').style.display = 'none';
}

// ===== MODAL SYSTEM =====
function openModal(modalId) {
  document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('show');
}

// Close modal when clicking outside
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal')) {
    e.target.classList.remove('show');
  }
});

// ===== PLAYTIME TRACKING =====
let playSessionStartTime = null;
let isIdleMode = false;
let idleTimer = null;
const IDLE_TIMEOUT = 5 * 60 * 1000; // 5 minutes

function startPlaytimeTracking() {
  if (!currentUser) return;
  if (!playSessionStartTime) {
    playSessionStartTime = Date.now();
    isIdleMode = false;
    console.log('[PLAYTIME] Session started');
  }
}

function resetIdleTimer() {
  clearTimeout(idleTimer);
  if (isIdleMode) {
    isIdleMode = false;
    playSessionStartTime = Date.now();
    console.log('[PLAYTIME] Idle mode ended, session resumed');
  }
  
  idleTimer = setTimeout(() => {
    isIdleMode = true;
    console.log('[PLAYTIME] Idle mode activated (5 min no activity)');
  }, IDLE_TIMEOUT);
}

function savePlaytime() {
  if (!currentUser || !playSessionStartTime || isIdleMode) return;
  
  userAccounts = JSON.parse(localStorage.getItem('userAccounts')) || {};
  const userData = userAccounts[currentUser];
  if (!userData) return;
  
  const today = new Date().toDateString();
  if (userData.lastQuestDate !== today) {
    userData.playtime = 0;
    userData.lastQuestDate = today;
  }
  
  const timeSpent = Math.floor((Date.now() - playSessionStartTime) / 1000 / 60);
  if (timeSpent > 0) {
    userData.playtime += timeSpent;
    playSessionStartTime = Date.now();
    localStorage.setItem('userAccounts', JSON.stringify(userAccounts));
    updateQuestUI();
  }
}

// Activity listeners
['mousedown', 'keydown', 'scroll', 'touchstart', 'click'].forEach(event => {
  document.addEventListener(event, () => {
    startPlaytimeTracking();
    resetIdleTimer();
  });
});

// Save playtime every 10 seconds
setInterval(() => { savePlaytime(); }, 10000);

// Save on page unload
window.addEventListener('beforeunload', () => {
  savePlaytime();
});

// Debug function
window.debugPlaytime = function() {
  console.log({
    currentUser,
    playSessionStartTime,
    isIdleMode,
    userAccounts
  });
};
</script>

</body>
</html>
